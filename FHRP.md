# Протокол резервирования первого перехода (FHRP)

В случае сбоя маршрутизатора или интерфейса маршрутизатора (который выступает в качестве шлюза по умолчанию), узел, для которого настроено использование этого шлюза по умолчанию, изолируется от внешних сетей. Требуется механизм для предоставления альтернативных шлюзов по умолчанию в коммутируемых сетях, где два или более маршрутизаторов подключены к одним и тем же сетям VLAN. Этот механизм обеспечивается протоколами резервирования первого перехода (FHRP).

![image](https://github.com/user-attachments/assets/19e95b63-5765-4d40-bd78-0351c2377ac1)

- **Протокол HSRP** - разработан CISCO для сетей IPv4. Активный маршрутизатор и резервный. Имеет вирутальный МАС и IPv4 адрес
- **HSRP для IPv6** - разработан CISCO. принцип работы как для IPv4
- **VRRPv2** - открытый протокол. несколько маршрутизаторов имеют один виртуальный IPv4. отвечает на ARP запросы только один - активный. остальные являются резервными
- **VRRPv3** - открытый протокол, работает аналогично. поддерживает протоколы IPv4 и IPv6
- **GLBP** - протокол CISCO. кроме резервирования может осуществлять балансировку нагрузки между маршрутизаторами
- **GLBP для IPv6** - разработан CISCO. принцип работы как для IPv4

## Настройка протокола HSRP

```bash
interface g0/1
  standby version 2            # версия протокола
  standby 1 ip 192.168.1.254   # виртуальны адрес
  standby 1 priority 150       # по умолчанию равен 100
  standby 1 preempt            # Приоритетное вытеснение — это способность маршрутизатора HSRP запускать процесс повторного выбора
```

> По умолчанию активный выбирается маршрутизатор с **максимальным** численным IP.

## Состояния HSRP
- **initial**    # после включения интерфейса
- **learn**      # ожидает получение виртуального IP адреса от активного маршрутизатора
- **listen**     # известен IP адрес, но роль не выбрана, слушает приветсвенные сообщения
- **speak**      # отправляет сообщения учавствует в выборах активного резервного маршрутизатора
- **standby**    # стал кондидатом на роль активного маршрутизатора
- **active**     # активный

> каждые 3 секунды маршрутизаторы отправляют сообщения на групповой адрес. Через 10 секунд отсутсвия сообщений, резервный станет активным

